<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI ê¸°ë°˜ ì£¼ì‹ ì¢…ëª© ë°œêµ´ ë° ìˆ˜ìµë¥  ì˜ˆì¸¡ ì‹œìŠ¤í…œ">
    <meta name="theme-color" content="#1a1a3a">
    <title>AI ì¢…ëª© ë°œêµ´</title>
    <style>
        :focus-visible { outline: 2px solid #8b5cf6; outline-offset: 2px; }
        .skip-link { position: absolute; top: -40px; left: 0; background: #8b5cf6; color: #fff; padding: 8px 16px; z-index: 100; text-decoration: none; border-radius: 0 0 4px 0; }
        .skip-link:focus { top: 0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif; background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%); color: #e0e0e0; min-height: 100vh; }
        .header { background: rgba(0, 0, 0, 0.4); padding: 20px 40px; border-bottom: 1px solid rgba(100, 100, 255, 0.2); }
        .header h1 { font-size: 24px; color: #fff; display: flex; align-items: center; gap: 12px; }
        .header h1::before { content: ''; display: inline-block; width: 8px; height: 8px; background: #00ff88; border-radius: 50%; box-shadow: 0 0 10px #00ff88; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .header-info { margin-top: 10px; font-size: 14px; color: #888; display: flex; align-items: center; gap: 20px; }
        .data-time { background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 4px 12px; border-radius: 6px; font-size: 13px; font-weight: 500; }
        .container { max-width: 1800px; margin: 0 auto; padding: 30px; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs { display: flex; gap: 4px; margin-bottom: 20px; background: rgba(0, 0, 0, 0.3); padding: 6px; border-radius: 12px; }
        .tab-btn { background: transparent; border: none; color: #888; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; }
        .tab-btn:hover { color: #fff; background: rgba(255, 255, 255, 0.05); }
        .tab-btn.active { background: linear-gradient(135deg, #8b5cf6, #06b6d4); color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .stats-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; }
        .stat-card .label { font-size: 13px; color: #888; margin-bottom: 8px; }
        .stat-card .value { font-size: 28px; font-weight: 700; color: #fff; }
        .stat-card .sub { font-size: 12px; color: #666; margin-top: 4px; }

        .info-box { background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(6, 182, 212, 0.1)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 20px 24px; margin-bottom: 20px; }
        .info-box h3 { font-size: 16px; color: #c084fc; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .info-box h3::before { content: '?'; display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: rgba(139, 92, 246, 0.3); border-radius: 50%; font-size: 12px; font-weight: 700; }
        .info-box p { font-size: 14px; line-height: 1.7; color: #a0a0a0; }
        .info-box .highlight { color: #22c55e; font-weight: 600; }

        .filters { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 10px; }
        .filter-group label { font-size: 13px; color: #a0a0a0; }
        .filter-group select, .filter-group input { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; padding: 8px 12px; border-radius: 6px; font-size: 14px; }
        .filter-reset { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.3); color: #f87171; padding: 8px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; margin-left: auto; }
        .filter-result-count { font-size: 13px; color: #a0a0a0; padding: 8px 12px; background: rgba(139, 92, 246, 0.1); border-radius: 6px; }
        .filter-result-count strong { color: #c084fc; }

        .table-container { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th { background: rgba(0, 0, 0, 0.8); padding: 14px 12px; text-align: left; font-size: 12px; font-weight: 600; color: #a0a0a0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); white-space: nowrap; cursor: pointer; user-select: none; position: sticky; top: 0; z-index: 10; transition: background 0.2s, color 0.2s; }
        th:hover { color: #fff; background: rgba(100, 100, 255, 0.4); }
        th .sort-indicator { color: #00ff88; margin-left: 4px; }
        td { padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.05); font-size: 13px; }
        tr:hover { background: rgba(100, 100, 255, 0.1); }
        .stock-name { font-weight: 600; color: #fff; cursor: pointer; transition: color 0.2s; }
        .stock-name:hover { color: #60a5fa; text-decoration: underline; }
        .stock-code { font-size: 11px; color: #666; margin-left: 6px; }
        .market-badge { font-size: 9px; padding: 1px 4px; border-radius: 3px; margin-left: 4px; }
        .market-kospi { background: rgba(59, 130, 246, 0.3); color: #93c5fd; }
        .market-kosdaq { background: rgba(168, 85, 247, 0.3); color: #d8b4fe; }
        .num { font-family: 'JetBrains Mono', 'Consolas', monospace; text-align: right; }
        .pct-positive { color: #ef4444; }
        .pct-negative { color: #3b82f6; }
        .pct-zero { color: #888; }

        .probability-bar { width: 80px; height: 22px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden; position: relative; }
        .probability-fill { height: 100%; transition: width 0.3s ease; }
        .probability-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 11px; font-weight: 600; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .prob-high .probability-fill { background: linear-gradient(90deg, #22c55e, #16a34a); }
        .prob-medium .probability-fill { background: linear-gradient(90deg, #eab308, #ca8a04); }
        .prob-low .probability-fill { background: linear-gradient(90deg, #64748b, #475569); }

        .recommendation { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; }
        .rec-buy { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .rec-hold { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .rec-pass { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

        .days-badge { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap; }
        .days-0 { background: rgba(239, 68, 68, 0.3); color: #fca5a5; }
        .days-recent { background: rgba(234, 179, 8, 0.2); color: #fcd34d; }
        .days-old { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

        .loading { text-align: center; padding: 60px; color: #888; }
        .no-data { text-align: center; padding: 60px; color: #666; }
        .footer { text-align: center; padding: 30px; color: #555; font-size: 13px; }
        .na { color: #666; }

        .pagination { display: flex; justify-content: center; align-items: center; gap: 6px; padding: 16px 20px; background: rgba(0, 0, 0, 0.3); border-top: 1px solid rgba(255, 255, 255, 0.1); border-radius: 0 0 12px 12px; flex-wrap: wrap; }
        .pagination-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); color: #a0a0a0; padding: 8px 14px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s; min-width: 40px; }
        .pagination-btn:hover:not(:disabled) { background: rgba(139, 92, 246, 0.2); border-color: rgba(139, 92, 246, 0.5); color: #fff; }
        .pagination-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .pagination-btn.active { background: linear-gradient(135deg, #8b5cf6, #06b6d4); border-color: transparent; color: #fff; font-weight: 700; }
        .pagination-info { color: #888; font-size: 13px; margin: 0 8px; }

        .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
        .toast { background: rgba(34, 197, 94, 0.95); color: #fff; padding: 12px 20px; border-radius: 8px; font-size: 14px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards; }
        .toast.info { background: rgba(59, 130, 246, 0.95); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateX(100%); } }

        @media (max-width: 768px) {
            .header { padding: 15px 20px; }
            .header h1 { font-size: 18px; }
            .container { padding: 20px 15px; }
            .stats-row { grid-template-columns: 1fr; gap: 12px; }
            .tabs { flex-wrap: wrap; }
            .tab-btn { padding: 10px 16px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <a href="#stock-table" class="skip-link">ë©”ì¸ í…Œì´ë¸”ë¡œ ì´ë™</a>
    <div class="toast-container" id="toast-container"></div>

    <header class="header">
        <h1>AI ì¢…ëª© ë°œêµ´</h1>
        <div class="header-info">
            <span id="header-desc">52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ ì¢…ëª© + ML ê¸°ë°˜ ìˆ˜ìµë¥  ì˜ˆì¸¡</span>
            <span class="data-time" id="updated-at">ë°ì´í„° ë¡œë”©ì¤‘...</span>
        </div>
    </header>

    <main class="container">
        <!-- íƒ­ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="high52w" onclick="switchTab('high52w')">52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ</button>
            <button class="tab-btn" data-tab="boxbreakout" onclick="switchTab('boxbreakout')">ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë¬´ê´€)</button>
        </div>

        <!-- 52ì£¼ ì‹ ê³ ê°€ íƒ­ -->
        <div id="tab-high52w" class="tab-content active">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="label">ë°œêµ´ëœ ì¢…ëª©</div>
                    <div class="value" id="total-count-52w">-</div>
                    <div class="sub">52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ</div>
                </div>
                <div class="stat-card">
                    <div class="label">BUY ì¶”ì²œ</div>
                    <div class="value" id="buy-count-52w">-</div>
                    <div class="sub">ì„±ê³µí™•ë¥  60%+ & ì˜ˆìƒìˆ˜ìµ 10%+</div>
                </div>
                <div class="stat-card">
                    <div class="label">í‰ê·  ì˜ˆìƒ ìˆ˜ìµë¥ </div>
                    <div class="value" id="avg-gain-52w">-</div>
                    <div class="sub">íšŒê·€ ëª¨ë¸ ì˜ˆì¸¡</div>
                </div>
                <div class="stat-card">
                    <div class="label">í‰ê·  ì„±ê³µ í™•ë¥ </div>
                    <div class="value" id="avg-prob-52w">-</div>
                    <div class="sub">10% ì´ìƒ ìƒìŠ¹ í™•ë¥ </div>
                </div>
            </div>

            <div class="info-box">
                <h3>ì„±ê³µ í™•ë¥ ì´ë€?</h3>
                <p>52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ í›„ <span class="highlight">20ê±°ë˜ì¼ ë‚´ ìµœê³ ê°€ê°€ ëŒíŒŒ ì‹œì  ëŒ€ë¹„ 10% ì´ìƒ ìƒìŠ¹</span>í•  í™•ë¥ ì…ë‹ˆë‹¤.</p>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>ì‹œì¥:</label>
                    <select id="filter-market-52w" onchange="renderTable52w()">
                        <option value="all">ì „ì²´</option>
                        <option value="KOSPI">KOSPI</option>
                        <option value="KOSDAQ">KOSDAQ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ì¶”ì²œ:</label>
                    <select id="filter-rec-52w" onchange="renderTable52w()">
                        <option value="all">ì „ì²´</option>
                        <option value="BUY">BUY</option>
                        <option value="HOLD">HOLD</option>
                        <option value="PASS">PASS</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ìµœì†Œ ì„±ê³µí™•ë¥ :</label>
                    <input type="number" id="filter-prob-52w" value="0" min="0" max="100" style="width: 70px;" onchange="renderTable52w()">%
                </div>
                <span class="filter-result-count" id="filter-result-count-52w">ê²€ìƒ‰ ê²°ê³¼: <strong>-</strong>ê°œ</span>
                <button class="filter-reset" onclick="resetFilters52w()">í•„í„° ì´ˆê¸°í™”</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th data-sort="name" onclick="sort52w('name')">ì¢…ëª©ëª…</th>
                            <th data-sort="close" onclick="sort52w('close')">í˜„ì¬ê°€</th>
                            <th data-sort="change_pct" onclick="sort52w('change_pct')">ë“±ë½ë¥ </th>
                            <th data-sort="marcap" onclick="sort52w('marcap')">ì‹œê°€ì´ì•¡</th>
                            <th data-sort="per" onclick="sort52w('per')">PER</th>
                            <th data-sort="pbr" onclick="sort52w('pbr')">PBR</th>
                            <th data-sort="breakout_pct" onclick="sort52w('breakout_pct')">ëŒíŒŒ ê°•ë„</th>
                            <th data-sort="vs_breakout_close" onclick="sort52w('vs_breakout_close')">ëŒíŒŒì¢…ê°€ëŒ€ë¹„</th>
                            <th data-sort="volume_surge" onclick="sort52w('volume_surge')">ê±°ë˜ëŸ‰ë¹„</th>
                            <th data-sort="days_since_breakout" onclick="sort52w('days_since_breakout')">ëŒíŒŒì¼<span class="sort-indicator">â–²</span></th>
                            <th data-sort="predicted_gain" onclick="sort52w('predicted_gain')">ì˜ˆìƒìˆ˜ìµ</th>
                            <th data-sort="success_probability" onclick="sort52w('success_probability')">ì„±ê³µí™•ë¥ </th>
                            <th data-sort="recommendation" onclick="sort52w('recommendation')">ì¶”ì²œ</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-52w">
                        <tr><td colspan="13" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                    </tbody>
                </table>
                <div id="pagination-52w" class="pagination"></div>
            </div>
        </div>

        <!-- ë°•ìŠ¤ê¶Œ ëŒíŒŒ íƒ­ -->
        <div id="tab-boxbreakout" class="tab-content">
            <div class="stats-row">
                <div class="stat-card">
                    <div class="label">ë°œêµ´ëœ ì¢…ëª©</div>
                    <div class="value" id="total-count-box">-</div>
                    <div class="sub">ë°•ìŠ¤ê¶Œ ëŒíŒŒ</div>
                </div>
                <div class="stat-card">
                    <div class="label">BUY ì¶”ì²œ</div>
                    <div class="value" id="buy-count-box">-</div>
                    <div class="sub">ì„±ê³µí™•ë¥  60%+ & ì˜ˆìƒìˆ˜ìµ 10%+</div>
                </div>
                <div class="stat-card">
                    <div class="label">í‰ê·  AI ì ìˆ˜</div>
                    <div class="value" id="avg-ai-box">-</div>
                    <div class="sub">ì„±ê³µí™•ë¥ Ã—0.7 + ìˆ˜ìµì ìˆ˜Ã—0.3</div>
                </div>
                <div class="stat-card">
                    <div class="label">í‰ê·  ì„±ê³µ í™•ë¥ </div>
                    <div class="value" id="avg-prob-box">-</div>
                    <div class="sub">15% ì´ìƒ ìƒìŠ¹ í™•ë¥ </div>
                </div>
            </div>

            <div class="info-box">
                <h3>ë°•ìŠ¤ê¶Œ ëŒíŒŒë€?</h3>
                <p>60ê±°ë˜ì¼ ì´ìƒ íš¡ë³´í•˜ë˜ ì¢…ëª©ì´ <span class="highlight">ë°•ìŠ¤ê¶Œ ìƒë‹¨(ì €í•­ì„ )ì„ ëŒíŒŒ</span>í•œ ì¢…ëª©ì…ë‹ˆë‹¤.<br>
                ì„±ê³µí™•ë¥ : ëŒíŒŒ í›„ 20ê±°ë˜ì¼ ë‚´ <span class="highlight">15% ì´ìƒ ìƒìŠ¹</span>í•  í™•ë¥  (XGBoost ë¶„ë¥˜ ëª¨ë¸)</p>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>ì‹œì¥:</label>
                    <select id="filter-market-box" onchange="renderTableBox()">
                        <option value="all">ì „ì²´</option>
                        <option value="KOSPI">KOSPI</option>
                        <option value="KOSDAQ">KOSDAQ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ì¶”ì²œ:</label>
                    <select id="filter-rec-box" onchange="renderTableBox()">
                        <option value="all">ì „ì²´</option>
                        <option value="BUY">BUY</option>
                        <option value="HOLD">HOLD</option>
                        <option value="PASS">PASS</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ìµœì†Œ AIì ìˆ˜:</label>
                    <input type="number" id="filter-ai-box" value="0" min="0" max="100" style="width: 70px;" onchange="renderTableBox()">
                </div>
                <span class="filter-result-count" id="filter-result-count-box">ê²€ìƒ‰ ê²°ê³¼: <strong>-</strong>ê°œ</span>
                <button class="filter-reset" onclick="resetFiltersBox()">í•„í„° ì´ˆê¸°í™”</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th data-sort="name" onclick="sortBox('name')">ì¢…ëª©ëª…</th>
                            <th data-sort="close" onclick="sortBox('close')">í˜„ì¬ê°€</th>
                            <th data-sort="change_pct" onclick="sortBox('change_pct')">ë“±ë½ë¥ </th>
                            <th data-sort="marcap" onclick="sortBox('marcap')">ì‹œê°€ì´ì•¡</th>
                            <th data-sort="per" onclick="sortBox('per')">PER</th>
                            <th data-sort="pbr" onclick="sortBox('pbr')">PBR</th>
                            <th data-sort="ai_score" onclick="sortBox('ai_score')">AIì ìˆ˜<span class="sort-indicator">â–¼</span></th>
                            <th data-sort="success_probability" onclick="sortBox('success_probability')">ì„±ê³µí™•ë¥ </th>
                            <th data-sort="predicted_gain" onclick="sortBox('predicted_gain')">ì˜ˆìƒìˆ˜ìµ</th>
                            <th data-sort="days_since_breakout" onclick="sortBox('days_since_breakout')">ëŒíŒŒì¼</th>
                            <th data-sort="gain_since_breakout" onclick="sortBox('gain_since_breakout')">ëŒíŒŒí›„ë“±ë½</th>
                            <th data-sort="recommendation" onclick="sortBox('recommendation')">ì¶”ì²œ</th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-box">
                        <tr><td colspan="12" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</td></tr>
                    </tbody>
                </table>
                <div id="pagination-box" class="pagination"></div>
            </div>
        </div>
    </main>

    <footer class="footer">
        AI ì¢…ëª© ë°œêµ´ ì‹œìŠ¤í…œ | ML ê¸°ë°˜ ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡
    </footer>

    <script>
        // ë°ì´í„°
        let stocks52w = [];
        let stocksBox = [];

        // ì •ë ¬ ìƒíƒœ
        let sort52wState = { column: 'days_since_breakout', direction: 'asc' };
        let sortBoxState = { column: 'ai_score', direction: 'desc' };

        // í˜ì´ì§€ë„¤ì´ì…˜
        let page52w = 1;
        let pageBox = 1;
        const itemsPerPage = 30;

        // íƒ­ ì „í™˜
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');

            // í—¤ë” ì„¤ëª… ë³€ê²½
            const desc = document.getElementById('header-desc');
            if (tabId === 'high52w') {
                desc.textContent = '52ì£¼ ì‹ ê³ ê°€ ëŒíŒŒ ì¢…ëª© + ML ê¸°ë°˜ ìˆ˜ìµë¥  ì˜ˆì¸¡';
            } else {
                desc.textContent = 'ë°•ìŠ¤ê¶Œ ëŒíŒŒ (ê±°ë˜ëŸ‰ ë¬´ê´€) + ML ê¸°ë°˜ ìˆ˜ìµë¥  ì˜ˆì¸¡';
            }
        }

        // í† ìŠ¤íŠ¸
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // ìˆ«ì í¬ë§·
        function formatNumber(n) {
            if (n === null || n === undefined || isNaN(n)) return '-';
            return n.toLocaleString();
        }

        function formatMarcap(n) {
            if (!n) return '-';
            if (n >= 10000) return (n / 10000).toFixed(1) + 'ì¡°';
            return formatNumber(n) + 'ì–µ';
        }

        // ì°¨íŠ¸ ì—´ê¸°
        function openChart(code) {
            window.open(`https://finance.naver.com/item/fchart.naver?code=${code}`, '_blank');
        }

        // ============================================================
        // 52ì£¼ ì‹ ê³ ê°€ íƒ­
        // ============================================================
        async function loadData52w() {
            try {
                const response = await fetch('data/ai_screener_results.json');
                if (!response.ok) throw new Error('ë°ì´í„° ì—†ìŒ');
                const data = await response.json();
                stocks52w = data.stocks || [];

                if (data.updated_at) {
                    document.getElementById('updated-at').textContent = `ğŸ“Š ${data.updated_at}`;
                }

                document.getElementById('total-count-52w').textContent = stocks52w.length;
                document.getElementById('buy-count-52w').textContent = stocks52w.filter(s => s.recommendation === 'BUY').length;

                if (stocks52w.length > 0) {
                    const avgGain = stocks52w.reduce((sum, s) => sum + s.predicted_gain, 0) / stocks52w.length;
                    const avgProb = stocks52w.reduce((sum, s) => sum + s.success_probability, 0) / stocks52w.length;
                    document.getElementById('avg-gain-52w').textContent = `+${avgGain.toFixed(1)}%`;
                    document.getElementById('avg-prob-52w').textContent = `${avgProb.toFixed(1)}%`;
                }

                renderTable52w();
                showToast(`52ì£¼ ì‹ ê³ ê°€: ${stocks52w.length}ê°œ ì¢…ëª© ë¡œë“œ`, 'info');
            } catch (e) {
                document.getElementById('stock-table-52w').innerHTML = '<tr><td colspan="13" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. python ai_screener.py ì‹¤í–‰ í•„ìš”</td></tr>';
            }
        }

        function sort52w(column) {
            if (sort52wState.column === column) {
                sort52wState.direction = sort52wState.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sort52wState.column = column;
                sort52wState.direction = ['name', 'days_since_breakout'].includes(column) ? 'asc' : 'desc';
            }
            page52w = 1;
            renderTable52w();
        }

        function resetFilters52w() {
            document.getElementById('filter-market-52w').value = 'all';
            document.getElementById('filter-rec-52w').value = 'all';
            document.getElementById('filter-prob-52w').value = '0';
            page52w = 1;
            renderTable52w();
        }

        function renderTable52w() {
            const market = document.getElementById('filter-market-52w').value;
            const rec = document.getElementById('filter-rec-52w').value;
            const minProb = parseFloat(document.getElementById('filter-prob-52w').value) || 0;

            let filtered = stocks52w.filter(s => {
                if (market !== 'all' && s.market !== market) return false;
                if (rec !== 'all' && s.recommendation !== rec) return false;
                if (s.success_probability < minProb) return false;
                return true;
            });

            document.getElementById('filter-result-count-52w').innerHTML = `ê²€ìƒ‰ ê²°ê³¼: <strong>${filtered.length}</strong>ê°œ`;

            // ì •ë ¬
            filtered.sort((a, b) => {
                let valA = a[sort52wState.column];
                let valB = b[sort52wState.column];
                if (valA === null || valA === undefined) valA = sort52wState.direction === 'asc' ? Infinity : -Infinity;
                if (valB === null || valB === undefined) valB = sort52wState.direction === 'asc' ? Infinity : -Infinity;
                if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = (valB || '').toLowerCase(); }
                let cmp = valA > valB ? 1 : valA < valB ? -1 : 0;
                return sort52wState.direction === 'asc' ? cmp : -cmp;
            });

            // í˜ì´ì§€ë„¤ì´ì…˜
            const totalPages = Math.ceil(filtered.length / itemsPerPage);
            if (page52w > totalPages && totalPages > 0) page52w = totalPages;
            const start = (page52w - 1) * itemsPerPage;
            const paged = filtered.slice(start, start + itemsPerPage);

            const tbody = document.getElementById('stock-table-52w');
            if (paged.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" class="no-data">ì¡°ê±´ì— ë§ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                document.getElementById('pagination-52w').innerHTML = '';
                return;
            }

            tbody.innerHTML = paged.map(s => {
                const probClass = s.success_probability >= 60 ? 'prob-high' : s.success_probability >= 50 ? 'prob-medium' : 'prob-low';
                const recClass = s.recommendation === 'BUY' ? 'rec-buy' : s.recommendation === 'HOLD' ? 'rec-hold' : 'rec-pass';
                const changePctClass = s.change_pct > 0 ? 'pct-positive' : s.change_pct < 0 ? 'pct-negative' : 'pct-zero';
                const daysClass = s.days_since_breakout === 0 ? 'days-0' : s.days_since_breakout <= 2 ? 'days-recent' : 'days-old';
                const daysText = s.days_since_breakout === 0 ? `${s.breakout_date} (ì˜¤ëŠ˜)` : `${s.breakout_date} (D+${s.days_since_breakout})`;

                return `<tr>
                    <td><span class="stock-name" onclick="openChart('${s.code}')">${s.name}</span><span class="market-badge market-${s.market.toLowerCase()}">${s.market}</span><span class="stock-code">${s.code}</span></td>
                    <td class="num">${formatNumber(s.close)}ì›</td>
                    <td class="num ${changePctClass}">${s.change_pct >= 0 ? '+' : ''}${s.change_pct}%</td>
                    <td class="num">${formatMarcap(s.marcap)}</td>
                    <td class="num ${s.per ? '' : 'na'}">${s.per ? s.per.toFixed(1) : '-'}</td>
                    <td class="num ${s.pbr ? '' : 'na'}">${s.pbr ? s.pbr.toFixed(2) : '-'}</td>
                    <td class="num ${s.breakout_pct >= 0 ? 'pct-positive' : 'pct-negative'}">${s.breakout_pct >= 0 ? '+' : ''}${s.breakout_pct}%</td>
                    <td class="num ${s.vs_breakout_close > 0 ? 'pct-positive' : s.vs_breakout_close < 0 ? 'pct-negative' : ''}">${s.vs_breakout_close >= 0 ? '+' : ''}${s.vs_breakout_close}%</td>
                    <td class="num">${s.volume_surge.toFixed(1)}x</td>
                    <td><span class="days-badge ${daysClass}">${daysText}</span></td>
                    <td class="num ${s.predicted_gain >= 0 ? 'pct-positive' : 'pct-negative'}">${s.predicted_gain >= 0 ? '+' : ''}${s.predicted_gain}%</td>
                    <td><div class="probability-bar ${probClass}"><div class="probability-fill" style="width: ${s.success_probability}%"></div><span class="probability-text">${s.success_probability}%</span></div></td>
                    <td><span class="recommendation ${recClass}">${s.recommendation}</span></td>
                </tr>`;
            }).join('');

            // í˜ì´ì§€ë„¤ì´ì…˜ UI
            renderPagination('pagination-52w', filtered.length, page52w, (p) => { page52w = p; renderTable52w(); });
        }

        // ============================================================
        // ë°•ìŠ¤ê¶Œ ëŒíŒŒ íƒ­
        // ============================================================
        async function loadDataBox() {
            try {
                const response = await fetch('data/box_breakout_results.json');
                if (!response.ok) throw new Error('ë°ì´í„° ì—†ìŒ');
                const data = await response.json();
                stocksBox = data.stocks || [];

                document.getElementById('total-count-box').textContent = stocksBox.length;
                document.getElementById('buy-count-box').textContent = stocksBox.filter(s => s.recommendation === 'BUY').length;

                if (stocksBox.length > 0) {
                    const avgAi = stocksBox.reduce((sum, s) => sum + s.ai_score, 0) / stocksBox.length;
                    const avgProb = stocksBox.reduce((sum, s) => sum + s.success_probability, 0) / stocksBox.length;
                    document.getElementById('avg-ai-box').textContent = avgAi.toFixed(1);
                    document.getElementById('avg-prob-box').textContent = `${avgProb.toFixed(1)}%`;
                }

                renderTableBox();
                showToast(`ë°•ìŠ¤ê¶Œ ëŒíŒŒ: ${stocksBox.length}ê°œ ì¢…ëª© ë¡œë“œ`, 'info');
            } catch (e) {
                document.getElementById('stock-table-box').innerHTML = '<tr><td colspan="12" class="no-data">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. python box_breakout_screener.py ì‹¤í–‰ í•„ìš”</td></tr>';
            }
        }

        function sortBox(column) {
            if (sortBoxState.column === column) {
                sortBoxState.direction = sortBoxState.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortBoxState.column = column;
                sortBoxState.direction = ['name', 'days_since_breakout'].includes(column) ? 'asc' : 'desc';
            }
            pageBox = 1;
            renderTableBox();
        }

        function resetFiltersBox() {
            document.getElementById('filter-market-box').value = 'all';
            document.getElementById('filter-rec-box').value = 'all';
            document.getElementById('filter-ai-box').value = '0';
            pageBox = 1;
            renderTableBox();
        }

        function renderTableBox() {
            const market = document.getElementById('filter-market-box').value;
            const rec = document.getElementById('filter-rec-box').value;
            const minAi = parseFloat(document.getElementById('filter-ai-box').value) || 0;

            let filtered = stocksBox.filter(s => {
                if (market !== 'all' && s.market !== market) return false;
                if (rec !== 'all' && s.recommendation !== rec) return false;
                if (s.ai_score < minAi) return false;
                return true;
            });

            document.getElementById('filter-result-count-box').innerHTML = `ê²€ìƒ‰ ê²°ê³¼: <strong>${filtered.length}</strong>ê°œ`;

            // ì •ë ¬
            filtered.sort((a, b) => {
                let valA = a[sortBoxState.column];
                let valB = b[sortBoxState.column];
                if (valA === null || valA === undefined) valA = sortBoxState.direction === 'asc' ? Infinity : -Infinity;
                if (valB === null || valB === undefined) valB = sortBoxState.direction === 'asc' ? Infinity : -Infinity;
                if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = (valB || '').toLowerCase(); }
                let cmp = valA > valB ? 1 : valA < valB ? -1 : 0;
                return sortBoxState.direction === 'asc' ? cmp : -cmp;
            });

            // í˜ì´ì§€ë„¤ì´ì…˜
            const totalPages = Math.ceil(filtered.length / itemsPerPage);
            if (pageBox > totalPages && totalPages > 0) pageBox = totalPages;
            const start = (pageBox - 1) * itemsPerPage;
            const paged = filtered.slice(start, start + itemsPerPage);

            const tbody = document.getElementById('stock-table-box');
            if (paged.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" class="no-data">ì¡°ê±´ì— ë§ëŠ” ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                document.getElementById('pagination-box').innerHTML = '';
                return;
            }

            tbody.innerHTML = paged.map(s => {
                const probClass = s.success_probability >= 60 ? 'prob-high' : s.success_probability >= 50 ? 'prob-medium' : 'prob-low';
                const recClass = s.recommendation === 'BUY' ? 'rec-buy' : s.recommendation === 'HOLD' ? 'rec-hold' : 'rec-pass';
                const changePctClass = s.change_pct > 0 ? 'pct-positive' : s.change_pct < 0 ? 'pct-negative' : 'pct-zero';
                const gainClass = s.gain_since_breakout > 0 ? 'pct-positive' : s.gain_since_breakout < 0 ? 'pct-negative' : '';
                const daysClass = s.days_since_breakout === 0 ? 'days-0' : s.days_since_breakout <= 2 ? 'days-recent' : 'days-old';
                const daysText = s.days_since_breakout === 0 ? `${s.breakout_date} (ì˜¤ëŠ˜)` : `${s.breakout_date} (D+${s.days_since_breakout})`;

                return `<tr>
                    <td><span class="stock-name" onclick="openChart('${s.code}')">${s.name}</span><span class="market-badge market-${s.market.toLowerCase()}">${s.market}</span><span class="stock-code">${s.code}</span></td>
                    <td class="num">${formatNumber(s.close)}ì›</td>
                    <td class="num ${changePctClass}">${s.change_pct >= 0 ? '+' : ''}${s.change_pct}%</td>
                    <td class="num">${formatMarcap(s.marcap)}</td>
                    <td class="num ${s.per ? '' : 'na'}">${s.per ? s.per.toFixed(1) : '-'}</td>
                    <td class="num ${s.pbr ? '' : 'na'}">${s.pbr ? s.pbr.toFixed(2) : '-'}</td>
                    <td class="num" style="font-weight:700; color:#c084fc;">${s.ai_score.toFixed(1)}</td>
                    <td><div class="probability-bar ${probClass}"><div class="probability-fill" style="width: ${s.success_probability}%"></div><span class="probability-text">${s.success_probability}%</span></div></td>
                    <td class="num ${s.predicted_gain >= 0 ? 'pct-positive' : 'pct-negative'}">${s.predicted_gain >= 0 ? '+' : ''}${s.predicted_gain}%</td>
                    <td><span class="days-badge ${daysClass}">${daysText}</span></td>
                    <td class="num ${gainClass}">${s.gain_since_breakout >= 0 ? '+' : ''}${s.gain_since_breakout}%</td>
                    <td><span class="recommendation ${recClass}">${s.recommendation}</span></td>
                </tr>`;
            }).join('');

            renderPagination('pagination-box', filtered.length, pageBox, (p) => { pageBox = p; renderTableBox(); });
        }

        // ============================================================
        // í˜ì´ì§€ë„¤ì´ì…˜ ê³µí†µ
        // ============================================================
        function renderPagination(containerId, totalItems, currentPage, onPageChange) {
            const container = document.getElementById(containerId);
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let html = `<button class="pagination-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="arguments[0].stopPropagation()">â—€ ì´ì „</button>`;

            const maxVisible = 5;
            let start = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let end = Math.min(totalPages, start + maxVisible - 1);
            if (end - start < maxVisible - 1) start = Math.max(1, end - maxVisible + 1);

            if (start > 1) html += `<button class="pagination-btn">1</button>`;
            if (start > 2) html += `<span class="pagination-info">...</span>`;

            for (let i = start; i <= end; i++) {
                html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}">${i}</button>`;
            }

            if (end < totalPages - 1) html += `<span class="pagination-info">...</span>`;
            if (end < totalPages) html += `<button class="pagination-btn">${totalPages}</button>`;

            html += `<button class="pagination-btn" ${currentPage === totalPages ? 'disabled' : ''}>ë‹¤ìŒ â–¶</button>`;
            html += `<span class="pagination-info">${(currentPage-1)*itemsPerPage+1}-${Math.min(currentPage*itemsPerPage, totalItems)} / ${totalItems}ê°œ</span>`;

            container.innerHTML = html;

            // ì´ë²¤íŠ¸ ë°”ì¸ë”©
            container.querySelectorAll('.pagination-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const text = btn.textContent.trim();
                    if (text === 'â—€ ì´ì „' && currentPage > 1) onPageChange(currentPage - 1);
                    else if (text === 'ë‹¤ìŒ â–¶' && currentPage < totalPages) onPageChange(currentPage + 1);
                    else if (!isNaN(parseInt(text))) onPageChange(parseInt(text));
                });
            });
        }

        // ì´ˆê¸° ë¡œë“œ
        loadData52w();
        loadDataBox();
    </script>
</body>
</html>
